# Google Apps Script 배포 및 연동 가이드

## ⚠️ 중요: URL 고정 방법

**한 번만 배포하고 URL을 고정하는 것이 핵심입니다!**

## 📋 전체 순서 (한 번만 하면 됨)

### 1단계: Google Apps Script 코드 배포 (최초 1회만)

1. **Google Sheets 열기**
   - 스프레드시트: https://docs.google.com/spreadsheets/d/1Ti5VbosoCFzi-4OhP4HDMe0p8JPAjVQmZlr9LiZkaOI/edit
   - 또는 직접 스프레드시트 열기

2. **Apps Script 편집기 열기**
   - `확장 프로그램` > `Apps Script` 클릭

3. **기존 코드 삭제**
   - 편집기에 있는 모든 코드 삭제

4. **새 코드 붙여넣기**
   - `google-apps-script-code.js` 파일의 전체 내용 복사
   - Apps Script 편집기에 붙여넣기
   - 저장 (Ctrl+S 또는 Cmd+S)

5. **배포 설정**
   - 상단 메뉴에서 `배포` > `새 배포` 클릭
   - 또는 `배포` > `배포 관리` > `새 배포` 클릭

6. **배포 구성**
   - 왼쪽 상단의 `유형 선택` 클릭
   - `웹 앱` 선택

7. **배포 설정 입력**
   - **설명**: `상담 신청 폼 API v1` (원하는 설명 입력)
   - **실행 대상**: `나` 선택
   - **액세스 권한**: **`모든 사용자`** ⚠️ 매우 중요!
   - `배포` 버튼 클릭

8. **권한 승인**
   - 처음 배포 시 권한 요청이 나타나면:
     - `권한 확인` 클릭
     - Google 계정 선택
     - `고급` > `안전하지 않은 페이지로 이동` 클릭
     - `허용` 클릭

9. **Web App URL 복사** ⭐ 중요!
   - 배포 완료 후 나타나는 Web App URL을 복사
   - 예: `https://script.google.com/macros/s/AKfycby.../exec`
   - **이 URL을 메모장이나 문서에 저장해두세요!**

10. **배포 ID 확인** (선택사항)
    - URL에서 `/s/` 다음의 긴 문자열이 배포 ID입니다
    - 예: `AKfycbyvyfKhD0SbuDQJBZazVnpzqXtdRwipMaAG4jZXwJfqPOGws_-yMqRAE4t_ltWDmLlyyw`

---

### 2단계: 프론트엔드 코드에 URL 설정 (최초 1회만)

1. **프로젝트 파일 열기**
   - `js/google-sheets-api.js` 파일 열기

2. **URL 업데이트**
   - 3번째 줄의 `GOOGLE_SCRIPT_URL` 값을 위에서 복사한 Web App URL로 변경
   ```javascript
   const GOOGLE_SCRIPT_URL = '여기에_복사한_URL_붙여넣기';
   ```

3. **저장**
   - 파일 저장

---

### 3단계: 코드 수정 시 주의사항

#### ✅ URL이 고정되는 경우 (권장)

**방법 1: 기존 배포 수정 (URL 유지)**
1. Apps Script 코드 수정
2. `배포` > `배포 관리` 클릭
3. 기존 배포 옆의 **연필 아이콘(편집)** 클릭
4. **설명만 변경** (예: `v1` → `v2`)
5. `새 버전` 체크박스 **체크하지 않음** ⚠️
6. `배포` 클릭
7. **URL이 그대로 유지됩니다!**

#### ❌ URL이 변경되는 경우 (피해야 함)

**새 배포를 만들면 URL이 변경됩니다:**
- `배포` > `새 배포` 클릭하면 새로운 URL 생성
- 이 경우 프론트엔드 코드도 다시 수정해야 함

---

## 🔄 코드 수정 후 재배포 순서 (URL 유지)

### 시나리오: Apps Script 코드를 수정했을 때

1. **Apps Script 편집기에서 코드 수정**
   - 코드 변경
   - 저장 (Ctrl+S)

2. **기존 배포 수정**
   - `배포` > `배포 관리` 클릭
   - 기존 배포 옆의 **연필 아이콘(편집)** 클릭
   - 설명 업데이트 (예: `v1.1`)
   - **`새 버전` 체크박스는 체크하지 않음** ⚠️
   - `배포` 클릭

3. **완료!**
   - URL은 그대로 유지됨
   - 프론트엔드 코드 수정 불필요

---

## 🆕 새 버전 배포가 필요한 경우

### 시나리오: 완전히 새로운 배포가 필요할 때만

1. **새 배포 생성**
   - `배포` > `새 배포` 클릭
   - 설정 입력 후 배포

2. **새 URL 복사**
   - 배포 후 나타나는 새 Web App URL 복사

3. **프론트엔드 코드 업데이트**
   - `js/google-sheets-api.js`의 `GOOGLE_SCRIPT_URL` 수정
   - 저장

4. **배포/테스트**
   - 변경사항 배포
   - 테스트

---

## ✅ 체크리스트

### 최초 설정 시
- [ ] Google Apps Script 코드 배포 완료
- [ ] Web App URL 복사 및 저장
- [ ] 프론트엔드 코드에 URL 설정
- [ ] 액세스 권한이 "모든 사용자"로 설정됨
- [ ] 테스트 완료

### 코드 수정 시
- [ ] Apps Script 코드 수정 및 저장
- [ ] 기존 배포 수정 (새 배포 생성하지 않음)
- [ ] `새 버전` 체크박스 체크하지 않음
- [ ] URL이 그대로 유지되는지 확인

---

## 🐛 문제 해결

### Q: URL이 계속 변경되는데요?
**A:** `배포 관리`에서 기존 배포를 수정할 때 `새 배포`를 만들지 마세요. 기존 배포의 편집 버튼을 사용하세요.

### Q: 코드를 수정했는데 반영이 안 돼요?
**A:** 
1. 코드 저장 확인
2. 배포 관리에서 배포 수정
3. 브라우저 캐시 클리어 (Ctrl+Shift+R)

### Q: CORS 오류가 발생해요?
**A:**
1. 액세스 권한이 "모든 사용자"로 설정되어 있는지 확인
2. 배포를 다시 수정하여 재배포

---

## 📝 요약

**핵심 원칙:**
1. ✅ 최초 1회만 새 배포 생성
2. ✅ 이후 코드 수정 시에는 기존 배포 수정
3. ✅ `새 버전` 체크박스 체크하지 않으면 URL 유지
4. ✅ URL이 변경되면 프론트엔드 코드도 업데이트 필요

**이 순서를 따르면 무한 반복 없이 한 번만 설정하면 됩니다!**

